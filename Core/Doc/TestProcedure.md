# 🧪 Lighting Ultra 系统测试程序

## 测试环境

### 硬件连接
```
PC/笔记本 ↔ USB转RS485 ↔ STM32F103C8T6 ↔ 继电器/LED模块
```

### 软件工具
- **Modbus Poll** 或 **QModMaster** 
- **Python + pymodbus**
- **串口助手** (备用)

## 📋 详细测试步骤

### 阶段1：基础连接测试

#### 1.1 连接验证
```
工具: Modbus Poll
配置: COM端口, 115200, 8N1
从设备ID: 1
功能码: 03 (读寄存器)
寄存器: 40001 (地址0)
数量: 1

期望结果: 成功读取数据，说明通信正常
```

#### 1.2 继电器状态读取
```
功能码: 03 (读寄存器)
起始寄存器: 40009 (地址8，继电器1状态)
数量: 5

期望结果: 返回5个值，全部为0 (继电器初始关闭状态)
```

### 阶段2：继电器控制测试

#### 2.1 单个继电器控制
```bash
# 测试继电器1 (PB4)
写寄存器: 40004 (地址3)  
值: 1 (开启)
观察: PB4引脚输出高电平，继电器/LED动作

写寄存器: 40004 (地址3)
值: 0 (关闭)  
观察: PB4引脚输出低电平，继电器/LED关闭
```

#### 2.2 依次测试所有继电器
| 继电器 | 控制寄存器 | 状态寄存器 | 测试引脚 | 操作 |
|--------|------------|------------|----------|------|
| 继电器1 | 40004 (地址3) | 40009 (地址8) | PB4 | 写入1→观察动作→写入0 |
| 继电器2 | 40005 (地址4) | 40010 (地址9) | PB3 | 写入1→观察动作→写入0 |
| 继电器3 | 40006 (地址5) | 40011 (地址10) | PA15 | 写入1→观察动作→写入0 |
| 继电器4 | 40007 (地址6) | 40012 (地址11) | PA12 | 写入1→观察动作→写入0 |
| 继电器5 | 40008 (地址7) | 40013 (地址12) | PA11 | 写入1→观察动作→写入0 |

### 阶段3：批量控制测试

#### 3.1 全部开启测试
```
功能码: 10 (写多个寄存器)
起始寄存器: 40004 (地址3)
数量: 5
数据: [1, 1, 1, 1, 1]

期望结果: 所有5个继电器同时开启
```

#### 3.2 状态反馈验证
```
功能码: 03 (读寄存器)  
起始寄存器: 40009 (地址8)
数量: 5

期望结果: 返回 [1, 1, 1, 1, 1]，确认所有继电器状态
```

### 阶段4：双通道测试

#### 4.1 通道1测试
```
从设备ID: 1
通过UART1 (PA9/PA10) + PA4(DE/RE)控制
测试所有继电器功能
```

#### 4.2 通道2测试  
```
从设备ID: 2 (如果配置了不同ID)
通过UART2 (PA2/PA3) + PA8(DE/RE)控制
测试所有继电器功能
```

## 错误排查

### 常见问题
1. **无响应**: 检查RS485连接和波特率
2. **超时错误**: 检查从设备地址是否正确
3. **CRC错误**: 检查接线和信号完整性
4. **继电器无动作**: 检查引脚连接和供电

### 测试记录表格
| 测试项 | 期望结果 | 实际结果 | 状态 | 备注 |
|--------|----------|----------|------|------|
| 连接测试 | 读取成功 | | ⭕ | |
| 继电器1控制 | PB4动作 | | ⭕ | |
| 继电器2控制 | PB3动作 | | ⭕ | |
| 继电器3控制 | PA15动作 | | ⭕ | |
| 继电器4控制 | PA12动作 | | ⭕ | |
| 继电器5控制 | PA11动作 | | ⭕ | |
| 状态反馈 | 实时状态正确 | | ⭕ | |
| 批量控制 | 同时动作 | | ⭕ | |

---
测试日期: ___________
测试人员: ___________
